<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Product Dashboard</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- CSS riêng -->
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-light">

<div class="container mt-4">
    <h2 class="text-center mb-4">PRODUCT DASHBOARD</h2>

    <!-- Search & Limit -->
    <div class="row mb-3">
        <div class="col-md-6">
            <input type="text"
                   class="form-control"
                   placeholder="Tìm kiếm theo title..."
                   oninput="searchTitle(this.value)">
        </div>

        <div class="col-md-3">
            <select class="form-select" onchange="changeLimit(this.value)">
                <option value="5">5 sản phẩm</option>
                <option value="10" selected>10 sản phẩm</option>
                <option value="20">20 sản phẩm</option>
            </select>
        </div>
    </div>

    <!-- Table -->
    <table class="table table-bordered table-hover align-middle text-center">
        <thead class="table-dark">
        <tr>
            <th>ID</th>
            <th>Image</th>
            <th class="sortable" onclick="sortTitle()">Title ⬍</th>
            <th>Category</th>
            <th class="sortable" onclick="sortPrice()">Price ⬍</th>
        </tr>
        </thead>

        <tbody id="product-body"></tbody>
    </table>

    <!-- Pagination -->
    <nav>
        <ul class="pagination justify-content-center" id="pagination"></ul>
    </nav>
</div>

<script>
let products = [];
let filteredProducts = [];
let currentPage = 1;
let limit = 10;
let titleAsc = true;
let priceAsc = true;

/* ================= FETCH DATA ================= */
fetch("https://api.escuelajs.co/api/v1/products")
    .then(res => res.json())
    .then(data => {
        products = data;
        filteredProducts = [...products];
        renderTable();
    });

/* ================= RENDER TABLE ================= */
function renderTable() {
    const start = (currentPage - 1) * limit;
    const end = start + limit;
    const pageData = filteredProducts.slice(start, end);

    const tbody = document.getElementById("product-body");
    tbody.innerHTML = "";

    pageData.forEach(p => {
        tbody.innerHTML += `
        <tr class="product-row">
            <td>${p.id}</td>
            <td>
                <img src="${p.images[0] || 'https://via.placeholder.com/60'}"
                     class="product-img">
            </td>
            <td>
                ${p.title}
                <div class="desc-box">${p.description}</div>
            </td>
            <td>${p.category.name}</td>
            <td>$${p.price}</td>
        </tr>
        `;
    });

    renderPagination();
}

/* ================= SEARCH ================= */
function searchTitle(keyword) {
    currentPage = 1;
    filteredProducts = products.filter(p =>
        p.title.toLowerCase().includes(keyword.toLowerCase())
    );
    renderTable();
}

/* ================= SORT ================= */
function sortTitle() {
    titleAsc = !titleAsc;
    filteredProducts.sort((a, b) =>
        titleAsc
            ? a.title.localeCompare(b.title)
            : b.title.localeCompare(a.title)
    );
    renderTable();
}

function sortPrice() {
    priceAsc = !priceAsc;
    filteredProducts.sort((a, b) =>
        priceAsc ? a.price - b.price : b.price - a.price
    );
    renderTable();
}

/* ================= PAGINATION ================= */
function renderPagination() {
    const pageCount = Math.ceil(filteredProducts.length / limit);
    const ul = document.getElementById("pagination");
    ul.innerHTML = "";

    for (let i = 1; i <= pageCount; i++) {
        ul.innerHTML += `
        <li class="page-item ${i === currentPage ? 'active' : ''}">
            <a class="page-link" href="#" onclick="goPage(${i})">${i}</a>
        </li>
        `;
    }
}

function goPage(page) {
    currentPage = page;
    renderTable();
}

/* ================= LIMIT ================= */
function changeLimit(value) {
    limit = Number(value);
    currentPage = 1;
    renderTable();
}
</script>

</body>
</html>
